<?php

$nom = $_POST['nom'];
$prenom = $_POST['prenom'];
$mail = $_POST['email'];
$motdepasse = $_POST['password'];
$datedenaissance = $_POST['datede naissance'];

$servername = "localhost";
$username = "root"; // L'utilisateur par défaut de MySQL dans XAMPP
$passwords = ""; // Laissez le mot de passe vide par défaut

// Nom de la base de données que vous avez créée dans phpMyAdmin
$database = "play";

//pour la vérification du statut
$statut = "membre";

// Créer une connexion
$conn = new mysqli($servername, $username, $passwords, $database);

// Vérifier la connexion
if ($conn->connect_error) {
    die("La connexion à la base de données a échoué : " . $conn->connect_error);
} 
else 
{
    // Vérifier si l'utilisateur existe déjà
    $checkUserQuery = "SELECT * FROM utilisateur WHERE mail='$mail'";
    $result = $conn->query($checkUserQuery);

    if ($result->num_rows > 0) {
        echo "Erreur : L'utilisateur avec l'adresse e-mail '$mail' existe déjà.";
    } else {
        // Hacher le mot de passe
        $hashedPassword = password_hash($motdepasse, PASSWORD_DEFAULT);

        // Insérer l'utilisateur avec le mot de passe haché
        $insertUserQuery = "INSERT INTO utilisateur (nom,prenom,mail,motdepasse,statut) values ('$nom','$prenom','$mail','$hashedPassword','$statut')";

        if ($conn->query($insertUserQuery) === TRUE) {
            echo "Inscription réussie! Redirection vers la page d'accueil...";
            header("Location: connexion.php");
        } else {
            echo "Erreur lors de l'inscription : " . $conn->error;
        }
    }
}

$conn->close();
?>